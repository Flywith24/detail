(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{87:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return u}));var a=n(2),r=n(6),o=(n(0),n(99)),c={slug:"creating-backup-system",title:"Creating a backup system with Runlet",author:"Gustavo Sampaio",author_title:"Core Maintainer",author_url:"https://github.com/GustavoKatel",author_image_url:"https://avatars0.githubusercontent.com/u/1891977?s=400&u=e33fb29ed6517d25974098a828720bd860b5ce5c&v=4",tags:["Runlet","Tutorial","Raspberry Pi"]},i={permalink:"/detail/blog/creating-backup-system",editUrl:"https://github.com/Flywith24/detail/edit/master/blog/2019-08-27-creating-backup-system.md",source:"@site/blog\\2019-08-27-creating-backup-system.md",description:"In this post I will go through a quick overview of how to manage and run jobs from the command line using Runlet CLI. If you haven\u2019t installed Runlet yet, I recommend you go to the releases page and check out our latest release that best fits your platform (Windows, Mac or Linux). Once installed you\u2019ll need to sign in to link the newly installed daemon to your account.",date:"2019-08-27T00:00:00.000Z",tags:[{label:"Runlet",permalink:"/detail/blog/tags/runlet"},{label:"Tutorial",permalink:"/detail/blog/tags/tutorial"},{label:"Raspberry Pi",permalink:"/detail/blog/tags/raspberry-pi"}],title:"Creating a backup system with Runlet",readingTime:2.395,truncated:!0,prevItem:{title:"Monitoring processes on Raspberry PI remotely with Runlet and htop",permalink:"/detail/blog/monitoring-processes-on-raspberry-pi"},nextItem:{title:"Introducing Runlet",permalink:"/detail/blog/introducing-runlet"}},l=[{value:"Creating a scheduled job",id:"creating-a-scheduled-job",children:[]},{value:"Automating backup of arbitrary directories",id:"automating-backup-of-arbitrary-directories",children:[]}],s={rightToc:l};function u(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"In this post I will go through a quick overview of how to manage and run jobs from the command line using Runlet CLI. If you haven\u2019t installed Runlet yet, I recommend you go to the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/runletapp/runlet/releases/"}),"releases page")," and check out our latest release that best fits your platform (Windows, Mac or Linux). Once installed you\u2019ll need to sign in to link the newly installed daemon to your account."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"runlet @signin\n")),Object(o.b)("p",null,"The QR code is useful if you are on a device with no browser. You can then use your mobile phone to authorize the daemon without having to type boring URLs. Once signed in you will be able to add or remove jobs."),Object(o.b)("h3",{id:"creating-a-scheduled-job"},"Creating a scheduled job"),Object(o.b)("p",null,"The first job that we\u2019ll create for our backup system will be responsible to compact and upload a bunch of important files to our backup server. We can create a job from the command line with the following line:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"runlet @config\n")),Object(o.b)("p",null,"If you\u2019re using Linux you must run as root"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"sudo runlet @config\n")),Object(o.b)("p",null,"This will open your editor defined in ",Object(o.b)("inlineCode",{parentName:"p"},"$EDITOR")," (Defaults to ",Object(o.b)("inlineCode",{parentName:"p"},"nano"),") with the correct configuration file. After closing the file will be merged with the current configuration and synced with the other connected daemons in your account."),Object(o.b)("p",null,"Let\u2019s define our job as follows:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'backup:\n  script: |\n    src=/myproject\n    hash=$(echo -n $src | md5sum | cut -c-32)\n    timestamp=$(date +"%m-%d-%Y-%H-%M")\n    dest="/tmp/$hash-$timestamp.tar.gz"\n    tar -zcvf $dest $src\n    cp $dest /backups\n  every: 0 16 * * *\n')),Object(o.b)("p",null,"Now save and close the file."),Object(o.b)("p",null,"This will create a job called ",Object(o.b)("inlineCode",{parentName:"p"},"backup")," that will run every day at 4pm. It works by compacting ",Object(o.b)("inlineCode",{parentName:"p"},"/myproject")," and storing the binaries at ",Object(o.b)("inlineCode",{parentName:"p"},"/backups"),"."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Note that this job will run on every connected daemon at the specified time."))),Object(o.b)("p",null,"If you want to manually run the job you can call like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"runlet @run backup\n")),Object(o.b)("p",null,"You should expect a file created at ",Object(o.b)("inlineCode",{parentName:"p"},"/backups"),"."),Object(o.b)("h3",{id:"automating-backup-of-arbitrary-directories"},"Automating backup of arbitrary directories"),Object(o.b)("p",null,"But what if we want to backup arbitrary directories? We can do that using ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/job/definition"}),"job arguments"),". By passing arguments you can change the behavior of a job before executing it. We use Golang\u2019s strong template engine to process every job script."),Object(o.b)("p",null,"Change the job to:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'backup:\n  script: |\n    {{ if gt (len .Args) 1 }}\n    src="{{ index .Args 1 }}"\n    {{ else }}\n    src="/myproject"\n    {{ end }}\n\n    hash=$(echo -n $src | md5sum | cut -c-32)\n    timestamp=$(date +"%m-%d-%Y-%H-%M")\n    dest="/tmp/$hash-$timestamp.tar.gz"\n    tar -zcvf $dest $src\n    cp $dest /backups\n  every: 0 16 * * *\n')),Object(o.b)("p",null,"As we can see on line 3 we check if there are any arguments passed during the call. If we have, we use it as ",Object(o.b)("inlineCode",{parentName:"p"},"src"),", otherwise we defaults to ",Object(o.b)("inlineCode",{parentName:"p"},"/myproject"),". We can then call from the command line like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"runlet @run backup /myproject/node_modules\n")),Object(o.b)("p",null,"We will then backup only the selected directory."))}u.isMDXComponent=!0},99:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),u=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},b=function(e){var t=u(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),b=u(n),d=a,m=b["".concat(c,".").concat(d)]||b[d]||p[d]||o;return n?r.a.createElement(m,i(i({ref:t},s),{},{components:n})):r.a.createElement(m,i({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,c=new Array(o);c[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var s=2;s<o;s++)c[s]=n[s];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);